# Как все это получилось
Кратко скажу, задача было не для выполнение за  4-5 часов. Чтобы написать сам README потрачу больше часа. Возможно есть разработчики который может выполнит все это за указанную время, тогда Я хотел бы чтобы стать их учеником. Далее рассмотрим как Я реализовал все задачи и сразу помечу потратил на это все примерно 10-11 часов.   

## Содержание
- [Технологии](#технологии)
- [Использование](#использование)
- [Разработка](#разработка)

## Технологии
- [БСП - версия 3.1.11.392](https://its.1c.ru/db/bsp3110doc)
- [1С - версия платформы 8.3.26.1521](https://its.1c.ru/db/bsp3110doc)
- [КД 2.1](https://infostart.ru/1c/articles/690292/)
- [СКД](https://infostart.ru/1c/articles/1082572/)

## Использование
### Требования
Для запуска базы и корректность синхронизации, необходим версия платформы не ниже 8.3.23.

Задание 2.1:

  -> Загрузить оба базы отдельно как новый ИБ
  
  -> Создать папку для обмена файлов(моем случае D:\1C\КД\УТГГ_БПГГ\Файлы обмена)
  
  -> Все изменении с базы УТГГ в справочниках Контрагенты, Номенклатура, Единицы измерении регистрируется для обмена.
  
  -> Все изменении в проведенных и только проведенные документы Реализации товаров и услуг с базы УТГГ регистрируется для обмена.
  
  [->](https://github.com/Xojiakbar17/GlobalGloriya/blob/a9e25425e32e636400fa53dc3f09ddc6fc926198/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA%20%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0%202026-02-19%20021935.png) На стороне УТГГ  На стороне УТГГ настроен рег.задания для запуска синхронизации базы и выгрузка случиться только если есть объекты регистрации в узле.
  
  [->](https://github.com/Xojiakbar17/GlobalGloriya/blob/a9e25425e32e636400fa53dc3f09ddc6fc926198/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA%20%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0%202026-02-19%20021935.png) На стороне УТГГ добавлен обработка для запуска синхронизации базы вручную и выгрузка случиться только если есть объекты регистрации в узле. Можно эго найти в вкладе Сервис.
  
  [->](https://github.com/Xojiakbar17/GlobalGloriya/blob/a9e25425e32e636400fa53dc3f09ddc6fc926198/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA%20%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0%202026-02-19%20021935.png) На стороне УТГГ добавлен журнал регистрации архива, где показывают вариант запуска синхронизации, время, номера пакетов отправки и получении, количество объектов регистрации на этом пакете и текст ошибки.
  
  -> На стороне БПГГ синхронизация запускается вручную на вкладке Администрирование - Синхронизация данных
  
  -> На стороне БПГГ нет ни какой регистрации объектов для выгрузки.
  
  -> На стороне БПГГ настроен Соответствия объектов информационных баз в случаи есть несоответствии объектов по УИД.
  
## Разработка
### **2.1** - Обмен данных между УТ и БП

-> Создал 2 пустых информационных базы с названием конфигурации УТГГ и БПГГ.

-> Внедрял БСП подсистемы "Настройки программы, Обмен данными и Регламентная задания" вместе подсистемами по умолчанию в обоих базах.

-> Для корректной работы конфигурации УТГГ создаль общий модуль "ОбновлениеИнформационнойБазыУТГГ" и в общей модуле "ПодсистемыКонфигурацииПереопределяемый" добавил часть кода
```typescript

// Определяет список модулей библиотек и конфигурации, которые предоставляют
// основные сведения о себе: имя, версия, список обработчиков обновления
// а также зависимости от других библиотек.
//
// Состав обязательных процедур такого модуля см. в общем модуле ОбновлениеИнформационнойБазыБСП
// (область ПрограммныйИнтерфейс).
// При этом сам модуль Библиотеки стандартных подсистем ОбновлениеИнформационнойБазыБСП
// не требуется явно добавлять в массив МодулиПодсистем.
//
// Параметры:
//  МодулиПодсистем - Массив - имена серверных общих модулей библиотек и конфигурации.
//                             Например: "ОбновлениеИнформационнойБазыБРО" - библиотека,
//                                       "ОбновлениеИнформационнойБазыБП"  - конфигурация.
//                    
Процедура ПриДобавленииПодсистем(МодулиПодсистем) Экспорт
	
	МодулиПодсистем.Добавить("ОбновлениеИнформационнойБазыУТГГ");
	
КонецПроцедуры

```
Для конфигурации БПГГ повторил операцию

-> Создал справочники "Контрагенты, Номенклатура и ЕдиницыИзмерении" в обоих базах.

-> Создал документ "Реализация товаров и услуг" в обоих базах. 

-> Создал новый объект план обмена "ОбменУТГГиБПГГ" и установил состав регситрации;

-> Для корректной отраженни обмена в модуле менеджера ОбменУТГГиБПГГ создал описании варианта обмена

```typescript
// Заполняет настройки, влияющие на использование плана обмена.
// 
// Параметры:
//  Настройки - Структура - настройки плана обмена по умолчанию, см. ОбменДаннымиСервер.НастройкиПланаОбменаПоУмолчанию,
//                          описание возвращаемого значения функции.
//
Процедура ПриПолученииНастроек(НастройкиПланаОбмена) Экспорт
	
	НастройкиПланаОбмена.Алгоритмы.ПриПолученииВариантовНастроекОбмена = Истина;
	НастройкиПланаОбмена.Алгоритмы.ПриПолученииОписанияВариантаНастройки = Истина;
	
КонецПроцедуры  

// Заполняет коллекцию вариантов настроек, предусмотренных для плана обмена.
// 
// Параметры:
//  ВариантыНастроекОбмена - ТаблицаЗначений - коллекция вариантов настроек обмена, см. описание возвращаемого значения
//                                       функции НастройкиПланаОбменаПоУмолчанию общего модуля ОбменДаннымиСервер.
//  ПараметрыКонтекста     - Структура - см. ОбменДаннымиСервер.ПараметрыКонтекстаПолученияВариантовНастроек,
//                                       описание возвращаемого значения функции.
//
Процедура ПриПолученииВариантовНастроекОбмена(ВариантыНастроекОбмена, ПараметрыКонтекста) Экспорт
	
	ВариантНастройки = ВариантыНастроекОбмена.Добавить();
	ВариантНастройки.ИдентификаторНастройки        = "";
	ВариантНастройки.КорреспондентВМоделиСервиса   = Ложь;
	ВариантНастройки.КорреспондентВЛокальномРежиме = Истина;

КонецПроцедуры

// Заполняет набор параметров, определяющих вариант настройки обмена.
// 
// Параметры:
//  ОписаниеВарианта       - Структура - набор варианта настройки по умолчанию,
//                                       см. ОбменДаннымиСервер.ОписаниеВариантаНастройкиОбменаПоУмолчанию,
//                                       описание возвращаемого значения.
//  ИдентификаторНастройки - Строка    - идентификатор варианта настройки обмена.
//  ПараметрыКонтекста     - Структура - см. ОбменДаннымиСервер.ПараметрыКонтекстаПолученияОписанияВариантаНастройки,
//                                       описание возвращаемого значения функции.
//
Процедура ПриПолученииОписанияВариантаНастройки(ОписаниеВарианта, ИдентификаторНастройки, ПараметрыКонтекста) Экспорт
	
	ОписаниеВарианта.ЗаголовокКомандыДляСозданияНовогоОбменаДанными = НСтр("ru='БП Gloriya Global';uz='БП Gloriya Global'");
	ОписаниеВарианта.КраткаяИнформацияПоОбмену = "Из УТ Gloriya Global на БП Gloriya Global";
	
КонецПроцедуры

```
Для конфигурации БПГГ повторил операцию

-> Для корректной работы обмена в общей модуле "ОбменДаннымиПереопределяемый" добавил часть кода 
```typescript
// Определяет список планов обмена, которые используют функционал подсистемы обмена данными.
//
// Параметры:
//  ПланыОбменаПодсистемы - Массив из ОбъектМетаданныхПланОбмена - массив планов обмена конфигурации,
//                          которые используют функционал подсистемы обмена данными.
//                          Элементами массива являются объекты метаданных планов обмена.
//
// Пример:
//   ПланыОбменаПодсистемы.Добавить(Метаданные.ПланыОбмена.ОбменБезИспользованияПравилКонвертации);
//   ПланыОбменаПодсистемы.Добавить(Метаданные.ПланыОбмена.ОбменСБиблиотекойСтандартныхПодсистем);
//   ПланыОбменаПодсистемы.Добавить(Метаданные.ПланыОбмена.РаспределеннаяИнформационнаяБаза);
//
Процедура ПолучитьПланыОбмена(ПланыОбменаПодсистемы) Экспорт
	
	ПланыОбменаПодсистемы.Добавить(Метаданные.ПланыОбмена.ОбменУТГГиБПГГ);	
	
КонецПроцедуры
```
Для конфигурации БПГГ повторил операцию

-> В ОбменУТГГиБПГГ добавил реквизити РежимВыгрузкиСправочников и РежимВыгрузкиДокументов с видом  "ПеречислениеСсылка.РежимыВыгрузкиОбъектовОбмена" для контроля регистрации объектов.

-> Создал две собитии на подписку для справочников и документа. Указала обаработчиком ранее созданного общего модуля "ОбменУТГГиБПГГ" при собитии "ПередЗаписью"

-> Запустиль базу УТГГ в режиме пользователя, создал описанния ИБ с помошю внеш.обработки "MD83Exp.epf".

-> Запустиль базу КД 2.1, создал конфигурацию ИБ для УТГГ с помошю его описанния базы далее создал там ПРО для справочников и документа. Сохранил в файл Правила регистрации.

-> В конфигураторе для ОбменУТГГиБПГГ добавил макет с называнием "ПравилаРегистрации" текстовом формате и скопировал туда ранее созданый ПРО в КД 2.1

-> Обновил базу УТГГ, включил возможность синхронизации и настроил узел обмена. Указал путь где хранить файлы обмена. Проверил работы регистрации. Павторил тоже самие дейтвии для БПГГ

-> Базе КД 2.1 создал 2 правило обмена УТГГ->БПГГ и БПГГ->УТГГ

-> В конфигураторе для ОбменУТГГиБПГГ добавил 2 макет с называнием "ПравилаОбмена" и "ПравилаОбменаКорреспондента"

-> Обновил обе базы УТГГ и БПГГ. Запустил и в регистре "ПравилаДляОбменаДанными" обновил правила конвертации данных

-> Далее завершаем настройку синхронизацию данных между базамы

-> Так теперь по задаче создадим рег задание и обработка для вручную запуска. 

-> Оба варианты запуска синхронизации обрашаеться к общей модудю "ОбменУТГГиБПГГ"
```typescript

Процедура ЗапускОбменУТГГиБПГГ(Вручную = Ложь) Экспорт
	
	ВремяОбмена = ТекущаяДата();
	ПараметрыЗагрузки = Новый Структура("ДатаРегистрации, РегистраторВыгрузки, Отправлен, Получен, КоличествоОбъектовКВыгрузке, ИнформацияПоОшибкам", ВремяОбмена, Перечисления.ВидыРегистрацииОбмена.Регламентно);
	УзелИнформационнойБазы = ПланыОбмена.ОбменУТГГиБПГГ.НайтиПоКоду("N2");	
	КоличествоОбъектовКВыгрузке = РассчитатьКоличествоЗарегистрированныхОбъектов(УзелИнформационнойБазы);
	ВыполнятьВыгрузку = ?(КоличествоОбъектовКВыгрузке = 0, Ложь, Истина);
	
	Если Вручную Тогда 
		ПараметрыЗагрузки.РегистраторВыгрузки = Перечисления.ВидыРегистрацииОбмена.Вручную;	
	КонецЕсли;
	
	ПараметрыОбмена = ОбменДаннымиСервер.ПараметрыОбмена();
	ПараметрыОбмена.ВыполнятьЗагрузку = Истина;
	ПараметрыОбмена.ВыполнятьВыгрузку = ВыполнятьВыгрузку; 
	ПараметрыОбмена.ИдентификаторТранспорта = "FILE"; 
	ПараметрыОбмена.ДанныеАутентификации = Неопределено;   
	ПараметрыОбмена.Вставить("УзелИнформационнойБазы", УзелИнформационнойБазы); 	
  	ПараметрыОбмена.Вставить("Отказ", Ложь);
	
	Попытка
		Обработки.ВыполнениеОбменаДанными.ВыполнитьЗапускОбменаДанными(ПараметрыОбмена, "");
	Исключение
		ИнформацияПоОшибкам = ОписаниеОшибки();
	КонецПопытки;
	
	НомераСообшении = ПолучитьНомераСообшении(УзелИнформационнойБазы);
	ПараметрыЗагрузки.Отправлен = НомераСообшении.НомерОтправленного;
	ПараметрыЗагрузки.Получен = НомераСообшении.НомерПринятого;
	ПараметрыЗагрузки.ИнформацияПоОшибкам = ИнформацияПоОшибкам;  
	ПараметрыЗагрузки.КоличествоОбъектовКВыгрузке = КоличествоОбъектовКВыгрузке; 
	ЗаписатьРезультатыОбмена(ПараметрыЗагрузки);
	
КонецПроцедуры

Функция ПолучитьНомераСообшении(Ссылка);
	
	Результат = Новый Структура("НомерОтправленного, НомерПринятого", 0, 0);
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ОбменУТГГиБПГГ.НомерОтправленного КАК НомерОтправленного,
		|	ОбменУТГГиБПГГ.НомерПринятого КАК НомерПринятого
		|ИЗ
		|	ПланОбмена.ОбменУТГГиБПГГ КАК ОбменУТГГиБПГГ
		|ГДЕ
		|	ОбменУТГГиБПГГ.Ссылка = &Ссылка";
	
	Запрос.УстановитьПараметр("Ссылка", Ссылка);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		ЗаполнитьЗначенияСвойств(Результат, ВыборкаДетальныеЗаписи); 
	КонецЦикла;    

	Возврат Результат;
	
КонецФункции 

Процедура ЗаписатьРезультатыОбмена(ПараметрыЗагрузки)
	
	ЗаписьОбмена = РегистрыСведений.ЖурналРегстрацииОбмена.СоздатьМенеджерЗаписи();
	ЗаписьОбмена.Прочитать();
	ЗаполнитьЗначенияСвойств(ЗаписьОбмена, ПараметрыЗагрузки);
	ЗаписьОбмена.Записать();
	
КонецПроцедуры

Функция РассчитатьКоличествоЗарегистрированныхОбъектов(Получатель) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ ЕдиницыИзмеренииИзменения.Ссылка) КАК КоличествоИзменении
		|ПОМЕСТИТЬ ВтИзменении
		|ИЗ
		|	Справочник.ЕдиницыИзмерении.Изменения КАК ЕдиницыИзмеренииИзменения
		|ГДЕ
		|	ЕдиницыИзмеренииИзменения.Узел = &Узел
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ КонтрагентыИзменения.Ссылка)
		|ИЗ
		|	Справочник.Контрагенты.Изменения КАК КонтрагентыИзменения
		|ГДЕ
		|	КонтрагентыИзменения.Узел = &Узел
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ НоменклатураИзменения.Ссылка)
		|ИЗ
		|	Справочник.Номенклатура.Изменения КАК НоменклатураИзменения
		|ГДЕ
		|	НоменклатураИзменения.Узел = &Узел
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ РеализацияТоваровИУслугИзменения.Ссылка)
		|ИЗ
		|	Документ.РеализацияТоваровИУслуг.Изменения КАК РеализацияТоваровИУслугИзменения
		|ГДЕ
		|	РеализацияТоваровИУслугИзменения.Узел = &Узел
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	СУММА(ВтИзменении.КоличествоИзменении) КАК КоличествоИзменении
		|ИЗ
		|	ВтИзменении КАК ВтИзменении";
	
	Запрос.УстановитьПараметр("Узел", Получатель);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	КоличествоОбъектовКВыгрузке = 0;
		
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		КоличествоОбъектовКВыгрузке = КоличествоОбъектовКВыгрузке + 1;		
	КонецЦикла;

	Возврат КоличествоОбъектовКВыгрузке;
	
КонецФункции

```
-> После синхронизации результат запишем в регистр "ЖурналРегстрацииОбмена"

### **2.2** - Оптимизация

#### Пример в задаче
```typescript
//-1// Необходимо сначала очистить регистр, из его отсуствие - при читение из базы есть вероятность отражение движении этого документа
//-2// Не установлен вариант блокировки перед читением остатки из базы, из его отсуствие 
//  // при читение из базы есть вероятность грязного отражение данных(Записи от нескольких пользователей одновременно) 
Для каждого СтрокаТЧ Из ТоварыНаРеализацию Цикл
	//-3// Не вижу параметры на какой время идет проверка остатков и по каким номкенклатурой, если эта так далее смотрет нет смысла
	//-4// Поиска каждый раз через запрос в базе одного номенклатуры не убёт время выпольнении опрерации
	Запрос.Текст = "ВЫБРАТЬ ...
	| РегистрНакопления.ТоварыНаСкладах.Остатки() ..."; 
	//-5// Если Выгурзить() потеряем отделная время для создание таблици и память, тут надо после выпольнить() использовать Следующий().
	//  // это нам дать есть ли резултат по запросу и получить через Если на первую строку
	Остатки = Запроса.Выполнить.Выгрузить();
	//-6// Обращение к непонятную таблицу через индекс грубая ошибка - нужно проверить сначала количество или резултать на Пустой()
	//  // Пример:
	//  // Остатки = Запроса.Выполнить(); 
	//  // Если Остатки.Следующий() Тогда
	//  // 		Если Остатки.КоличествоОстатков < СтрокаТЧ.Количество Тогда
	//  //			Сообщить("Недостаточно товара!");
	//  //			Отказ = Истина; 
	//  //		КонецЕсли;
	//  // КонецЕсли;
	Если Остатки[0].КоличествоОстатков < СтрокаТЧ.Количество Тогда
		//-7// Могли бы тут какой товар именно в недостатче и сколько не хвататет 
		Сообщить("Недостаточно товара!");
		Отказ = Истина; 
	КонецЕсли;
	//-8// Тут можно сказать записать в регистр в случии Отказа как то оптимизироать. Да есть способ проверку только на недостачу потом на запись.
	// // Но моем примере попробую показать другой метой оптимизации	
	Движение = Движения.ТоварыНаСкладах.ДобавитьРасход();
	Движение.Период = Дата;
	Движение.Номенклатура = СтрокаТЧ.Номенклатура;
	Движение.Количество = СтрокаТЧ.Количество;

КонецЦикла;

//-9//  Если Отказ = Истина далее какой-то операцию выпольнить неправильно
Движения.ТоварыНаСкладах.Записать();
```

#### Вариант который Я предлагаю для оптимизации
```typescript
Движения.ОстаткиТоваров.Записывать = Истина;
//1// Очистим текущие записи, в случае если документ проводиться не первый раз
Движения.ОстаткиТоваров.Очистить();
//2// Добавляю записи в регистр для этой же транзакции 
Для каждого СтрокаТЧ Из ТоварыНаРеализацию Цикл
	Движение = Движения.ТоварыНаСкладах.ДобавитьРасход();
	Движение.Период = Дата;
	Движение.Номенклатура = СтрокаТЧ.Номенклатура;
	Движение.Количество = СтрокаТЧ.Количество;
КонецЦикла;
//3// Блокирую запись регистра для изменении, это нам позволяет блокировать только те данные для этой же транзакции  
Движения.ОстаткиТоваров.БлокироватьДляИзменения = Истина;

Движения.Записать();

Запрос = Новый Запрос;
//4// Проверяю как это влияет на регистр остатов 
Запрос.Текст = "ВЫБРАТЬ
				| ТоварыНаРеализацию.Товар КАК Номенклатура,
				| СУММА(ТоварыНаРеализацию.Количество) КАК Количество
				|ПОМЕСТИТЬ ВтДокТЧ
				|ИЗ
				| Документ.РасходнаяНакладная.ТоварыНаРеализацию КАК ТоварыНаРеализацию
				|ГДЕ
				| ТоварыНаРеализацию.Ссылка = &Ссылка
				|
				|СГРУППИРОВАТЬ ПО
				| ТоварыНаРеализацию.Номенклатура
				|
				|ИНДЕКСИРОВАТЬ ПО
				| Номенклатура
				|;
				|
				|////////////////////////////////////////////////////////////////////////////
				|ВЫБРАТЬ
				| Остатки.Номенклатура.Представление КАК НоменклатураПредставление,
				| Остатки.КоличествоОстаток
				|ИЗ
				| РегистрНакопления.ТоварыНаСкладах.Остатки(&Период,
				| 						Номенклатура В (ВЫБРАТЬ
				| 										ВтДокТЧ.Номенклатура
				| 										ИЗ
				| 										ВтДокТЧ КАК ВтДокТЧ)) КАК Остатки
				|ГДЕ
				| Остатки.КоличествоОстаток < 0";
Запрос.УстановитьПараметр("Ссылка", Ссылка);
//5// Установим точную границу по времени
Запрос.УстановитьПараметр("Период", Новый Граница(Новый МоментВремени(Дата, Ссылка), ВидГраницы.Включая));
Результат = Запрос.Выполнить();

//6// Если Рузультат пустой, можем продолжать
Если НЕ Результат.Пустой() Тогда

	Отказ = Истина;
    //7// Иначе Сообщим об недостотке товара и признак Отказ = истина
	Выборка = Результат.Выбрать();
	Пока Выборка.Следующий() Цикл
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = "Недостаточно товара: " + Выборка.ТоварПредставление + ", нужно еще: " + (-Выборка.КоличествоОстаток);
		Сообщение.Сообщить();
	КонецЦикла;
	
КонецЕсли;

//8// После отказа транзации, движении в регистре должно удалиться 
Если Отказ Тогда
	Возврат;
КонецЕсли;

```
**ИТОГ**: Сравнении с примером для проверки, этот код работает правильнее, оптимальнее и информативнее. Блокировка тут использован самом транзакции записи регистра. Если бы в документе был 300 товоров, для его проверки и записи ушло бы примерно 2-3 раза меньше времени чем пример в задаче. Я не проверял этого, чисто из опыта


### **2.3** - СКД отчет и Расширения 1С

  ->Внешный отчет "Дебиторская задолженность" создать на основе регситра накоплении "Рассчеты с покупателямы", ВТ таблица **остатки**.  На дату формировния который можно указать на форме покажет количество дней задолженности и исползуется оформления по условию 30+ желтый, 60+ красный и если 0 зеленый.

  ->Расширения добавлен в базу УТГГ
  
Текст запроса СКД отчета:
```sh
ВЫБРАТЬ
	РасчетыСПокупателями.Документ.Дата КАК ДокументДата,
	РасчетыСПокупателями.Контрагент КАК Контрагент,
	РасчетыСПокупателями.Документ КАК Документ
ПОМЕСТИТЬ ВтДокументы
ИЗ
	РегистрНакопления.РасчетыСПокупателями КАК РасчетыСПокупателями
ГДЕ
	РасчетыСПокупателями.Период <= &Период
	И РасчетыСПокупателями.Документ ССЫЛКА Документ.РасходнаяНакладная

СГРУППИРОВАТЬ ПО
	РасчетыСПокупателями.Документ,
	РасчетыСПокупателями.Контрагент,
	РасчетыСПокупателями.Документ.Дата

ИНДЕКСИРОВАТЬ ПО
	Контрагент
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВтДокументы.Контрагент КАК Контрагент,
	ВтДокументы.Документ КАК Документ,
	ВтДокументы.ДокументДата КАК Дата,
	ЕСТЬNULL(РасчетыСПокупателямиОстатки.СуммаОстаток, 0) КАК Сумма,
	РАЗНОСТЬДАТ(ВтДокументы.ДокументДата, &Период, ДЕНЬ) КАК КолчиествоДней
ИЗ
	ВтДокументы КАК ВтДокументы
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.РасчетыСПокупателями.Остатки(&Период, ) КАК РасчетыСПокупателямиОстатки
		ПО ВтДокументы.Контрагент = РасчетыСПокупателямиОстатки.Контрагент
			И ВтДокументы.Документ = РасчетыСПокупателямиОстатки.Документ
```

